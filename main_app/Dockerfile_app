# Dockerfile_app (ubicado en ~/Smart-Home-AI/main_app/Dockerfile_app)

FROM python:3.9-slim-bullseye

WORKDIR /app

# Instalar dependencias del sistema si es necesario
RUN apt-get update && \
    apt-get install -y --no-install-recommends python-is-python3 && \
    rm -rf /var/lib/apt/lists/*

# Copiar el archivo de requisitos de la aplicación y luego instalar las dependencias de Python.
COPY main_app/requirements_app.txt .
RUN pip install --no-cache-dir -r requirements_app.txt

# Copiar el código de la aplicación principal, plantillas y archivos estáticos
COPY main_app/app.py ./main_app/
COPY main_app/static/ ./main_app/static/
COPY main_app/templates/ ./main_app/templates/

# Copiar la lógica central (código compartido)
COPY core_logic/ ./core_logic/

# El directorio 'knowledge' se maneja mediante un montaje de volumen en docker-compose.yml.

# Establecer el punto de entrada para la aplicación principal con la ruta completa a python
CMD ["/usr/local/bin/python", "main_app/app.py"]
